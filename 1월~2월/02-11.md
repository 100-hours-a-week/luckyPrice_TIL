## < ì‹œë‚˜ë¦¬ì˜¤ >
1. Docker hubì—ì„œ nginx imageë¡œ ë¶ˆëŸ¬ì™€ì„œ, containerë¡œ ë™ì‘ì‹œí‚¨ë‹¤.
2. Nginxì˜ ê¸°ë³¸ index.htmlì„ ìˆ˜ì •í•œë‹¤. (hello!)
3. ì €ì¥í•˜ì—¬ ìƒˆë¡œìš´ commit_test:10 imageë¡œ ë§Œë“ ë‹¤.
4. Commit_test:1.0 imageë¡œ ìƒˆë¡œìš´ containerë¥¼ ë„ìš´ë‹¤.
5. ìƒˆë¡œìš´ Index.htmlì„ hostì—ì„œ cpí•œë‹¤. (hi!)
6. í•´ë‹¹ containerë¥¼ ê·¸ëŒ€ë¡œ imageí™” ì‹œí‚¨ë‹¤. Commit_test:2.0


![](https://velog.velcdn.com/images/luckyprice1103/post/410e1b27-6a95-4e5a-9eb5-dbcf1d0d3be9/image.png)



â€¢ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
 ```bash
ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ ì»¨í…Œì´ë„ˆ ìƒì„±
 docker run-it--name commit_test_container -p 9999:80 nginx
 nginx ì»¨í…Œì´ë„ˆì— ë“¤ì–´ê°€ê¸°
 docker exec -it comit_test_container /bin/bash
```
â€¢ Index.html ì„ ì°¾ì•„ì„œ ìˆ˜ì •
```bash
rootak8237840:/# find /-name index.html
/usr/share/nginx/html/index.html
root@k8237840:/# apt-get update
â€¢ Hello ê°€ ë‚˜ì˜¤ëŠ” index.htmlë¡œ ìˆ˜ì •
```

![](https://velog.velcdn.com/images/luckyprice1103/post/23b4f60b-27bb-42da-8f66-ad1764396312/image.png)

â€¢ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
â€¢ Docker commit [option] CONTAINER [REPOSITORY[:TAG]]
â€¢ -a : author (ì´ë¯¸ì§€ ì‘ì„±ì) ë©”íƒ€ë°ì´í„°ë¥¼ ì´ë¯¸ì§€ì— ì €ì¥
â€¢ -m : ì»¤ë°‹ ë©”ì‹œì§€ ì…ë ¥, ì´ë¯¸ì§€ ì„¤ëª… ì…ë ¥
â€¢ ë³€ê²½ëœ index.html í™•ì¸ - http://localhost:9999
 docker commit ëª…ë ¹ì„ ì‚¬ìš©, ìƒˆë¡œìš´ ì´ë¯¸ì§€ ìƒì„±
 ```bash
docker commit \
 -a "user1"-m "first commit" \
comnit_test_container \
Commit_test: 1.0
```
 ì´ë¯¸ì§€ ìƒì„± í™•ì¸
 docker images
![](https://velog.velcdn.com/images/luckyprice1103/post/62a36c7d-eae5-4fef-a00a-35d4af187537/image.png)


â€¢ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
â€¢ ìƒì„±ëœ ì´ë¯¸ì§€ë¡œ ë‹¤ì‹œ container ìƒì„±
docker run-d--name commit_test2_container\
-p 8888:80 commit_test: 1.0
â€¢ ìƒˆë¡œìš´ nginxê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
http://localhost:8888

![](https://velog.velcdn.com/images/luckyprice1103/post/6f6641f9-bc8b-4411-8e6d-011ed83ac15a/image.png)

â€¢ Index.html ë³€ê²½í•˜ê¸° - docker cp ì‚¬ìš©
docker cp /home/ubuntu/index.html
commit_test2_container:/usr/share/nginx/html/index.html

index.html
![](https://velog.velcdn.com/images/luckyprice1103/post/a47d930a-0acf-4f39-a7a1-516d6578835e/image.png)
![](https://velog.velcdn.com/images/luckyprice1103/post/a7c6dae1-cffa-48f2-8f98-e95d4bcb58ab/image.png)
![](https://velog.velcdn.com/images/luckyprice1103/post/16e2f52d-a694-4657-ad6d-030e4cbcb10b/image.png)

	
![](https://velog.velcdn.com/images/luckyprice1103/post/577864cd-6926-4104-9c51-776c37b50349/image.png)

## ë„ì»¤ ì´ë¯¸ì§€ ë°°í¬ - pubic registry
![](https://velog.velcdn.com/images/luckyprice1103/post/70b53439-01dd-4656-979e-0a29f4fabea7/image.png)
![](https://velog.velcdn.com/images/luckyprice1103/post/7da16bed-4f9f-4d42-b24b-72b5d6b464a7/image.png)

- docker hub ë¡œê·¸ì¸
![](https://velog.velcdn.com/images/luckyprice1103/post/cc3580bf-4920-4a75-a25a-61c58ed952fc/image.png)


- ì´ë¯¸ì§€ ì´ë¦„ ë°”ê¿”ì£¼ê¸° docker tag antoinebou12/retroarch-web-games [dockerhub ì•„ì´ë””]/retroarch:0.0

- docker hubì— push.
![](https://velog.velcdn.com/images/luckyprice1103/post/d3b90ab7-5068-421e-92b5-b776cb14e8a4/image.png)




## ë„ì»¤ ì´ë¯¸ì§€ ë°°í¬ - private registry
## ì‹œë‚˜ë¦¬ì˜¤
ìƒˆë¡œìš´ Docker Registry VM ë¨¸ì‹ ì— private registry ì„¤ì¹˜
â€¢ 1) Ubuntu ì„¤ì¹˜ - ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìŒ
â€¢ 2) docker ì„¤ì¹˜ - docker docs
â€¢ https://docs.docker.com/engine/install/ubuntu/
â€¢ 3) docker hubì—ì„œ registry image ë°›ì•„ì™€ì„œ ì„¤ì¹˜
Clientì—ì„œ ì„¤ì • ë³€ê²½
â€¢ 4) imageë¥¼ push/pullí•˜ëŠ” clientì— private registryê°€ ì•ˆì „í•˜ë‹¤ê³  ì„¤ì •
â€¢ 5) image push/pull


# ì¢‹ì€ ë„ì»¤íŒŒì¼ì„ ë§Œë“œëŠ” ë°©ë²•

### - ì‚¬ì„¤ registry ì €ì¥ì†Œ ìƒì„±.
![](https://velog.velcdn.com/images/luckyprice1103/post/eafea8c4-bb54-462d-8090-24a6af4c632e/image.png)
## 1. ì¢‹ì€ ë„ì»¤íŒŒì¼ì„ ë§Œë“œëŠ” ë°©ë²•

Dockerfileì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ë‹¨ê³„ì™€ ìœ ì‚¬í•œ ë‹¨ê³„ê°€ ìˆë‹¤.

> 1. ìš´ì˜ ì²´ì œë¡œ ì‹œì‘
2. ì–¸ì–´ ëŸ°íƒ€ì„ ì„¤ì¹˜
3. ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ì†ì„± ì„¤ì¹˜
4. ì‹¤í–‰ í™˜ê²½ ì„¤ì •
5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

ì°¸ê³ : OS ë° ì–¸ì–´ ëŸ°íƒ€ì„ì´ ì‚¬ì „ ì„¤ì¹˜ëœ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ 3ë²ˆìœ¼ë¡œ ë°”ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ ë§ë‹¤.

> ìœ ìš©í•œ ê¸°ìˆ 

1. íŠ¹ì • ê¸°ë³¸ ì´ë¯¸ì§€ ê³ ì •
 - By specifying an image tag, you can avoid nasty surprises where the base image
 
 2. ì‘ì€ ê¸°ë³¸ì´ë¯¸ì§€ ì„ íƒ
 - ìš°ë¦¬ëŠ” ë‹¤ì–‘í•œ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒ í•  ìˆ˜ ìˆëŠ”ë° ë” ì‘ì€ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ ìµœì¢…ì ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ëŠ”ë°ì— ì¢‹ë‹¤.
 
3. ë” ì•ˆì „í•œ ê¸°ë³¸ ì´ë¯¸ì§€ ì„ íƒ
- ì´ë¯¸ì§€ í¬ê¸°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ ì´ë¯¸ì§€ì˜ ì·¨ì•½ì  ìˆ˜ì™€ ê³µê²© ë…¸ì¶œ ì˜ì—­ë„ ê°™ì´ ê³ ë ¤í•´ì•¼í•œë‹¤. ChainaurdëŠ” ë‹¤ìˆ˜ì˜ ê°•í™”ëœ ì´ë¯¸ì§€ë¥¼ ê²Œì‹œí•œë‹¤.
 (https://www.chainguard.dev/chainguard-images).
 
 4. ì‘ì—… ê³µê°„ ì§€ì •
 - ë§ì€ ì–¸ì–´ì—ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•/ìœ„ì¹˜ì— ëŒ€í•œ ê·œì¹™ì´ ìˆë‹¤. í•´ë‹¹ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ë©´ ê°œë°œìê°€ ì»¨í…Œì´ë„ˆ ì‘ì—…ì„ ë” ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤.
 
 5. ë¹Œë“œ ì†ë„ë¥¼ ê°œì„ í•˜ê¸°ìœ„í•œ ë ˆì´ì–´ ìºì‹œ
 - ì»¨í…Œì´ë„ˆ íŒŒì¼ ì‹œìŠ¤í…œì˜ ê³„ì¸µì  íŠ¹ì„±ì„ ì´í•´í•˜ê³  íŠ¹ì • íŒŒì¼ì„ ë³µì‚¬í•  ì‹œê¸°ë¥¼ ì„ íƒí•¨ìœ¼ë¡œì¨ Docker ìºì‹± ì‹œìŠ¤í…œì„ ë” ì˜ í™œìš©í•  ìˆ˜ ìˆë‹¤.
 
 6. COPY â€”link ì ì ˆí•˜ê²Œ ì‚¬ìš©
 - --link ì˜µì…˜ì€ 2022ë…„ 3ì›” COPY ëª…ë ¹ì— ì¶”ê°€ë˜ì—ˆë‹¤. ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ì´ì „ í•­ëª©ì— ì¢…ì†ë˜ì§€ ì•ŠëŠ” ë…ë¦½ì ì¸ ì´ë¯¸ì§€ ë ˆì´ì–´ì— íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ íŠ¹ì • ìƒí™©ì—ì„œ ìºì‹œ ë™ì‘ì„ ê°œì„ í•  ìˆ˜ ìˆë‹¤.
 
 7. ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ë£¨íŠ¸ê°€ ì•„ë‹Œ ì‚¬ìš©ì ì‚¬ìš©
 - ì»¨í…Œì´ë„ˆëŠ” ì‚¬ìš©ì ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë£¨íŠ¸ì™€ í˜¸ìŠ¤íŠ¸ì˜ ë£¨íŠ¸ë¥¼ êµ¬ë³„í•  ìˆ˜ ìˆì§€ë§Œ ì´ ê¸°ëŠ¥ì´ í•­ìƒ í™œìš©ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë©° ë£¨íŠ¸ê°€ ì•„ë‹Œ ì‚¬ìš©ìë¥¼ ì‚¬ìš©í•˜ë©´ ì»¨í…Œì´ë„ˆì˜ ê¸°ë³¸ ì•ˆì „ì„±ì´ í–¥ìƒëœë‹¤. Docker Desktopì„ ì‚¬ìš©í•  ë•Œ ì‹¤í–‰ë˜ëŠ” ê°€ìƒ ë¨¸ì‹ ì€ ì»¨í…Œì´ë„ˆì™€ í˜¸ìŠ¤íŠ¸ ì‚¬ì´ì— ê²©ë¦¬ ê²½ê³„ë¥¼ ì œê³µí•˜ì§€ë§Œ Docker ì—”ì§„ì„ ì‹¤í–‰í•˜ëŠ” ê²½ìš° ì‚¬ìš©ì ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ê²©ë¦¬ë¥¼ ë³´ì¥í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
 
 8. í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ì— ëŒ€í•œ í”„ë¡œë•ì…˜ ì¢…ì†ì„±ë§Œ ì„¤ì¹˜í•˜ê³  ê·¸ì— ë”°ë¼ ì–¸ì–´ ëŸ°íƒ€ì„ì„ êµ¬ì„±í•˜ëŠ” ë° í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì§€ì •.
 
>  ì´ëŸ¬í•œ ê¸°ìˆ  ì ìš©ì˜ ì˜í–¥

ì¼ë°˜ì ìœ¼ë¡œ ì´ëŸ¬í•œ ê¸°ìˆ ì€ (1) ë¹Œë“œ ì†ë„, (2) ì´ë¯¸ì§€ ë³´ì•ˆ ë° (3) ê°œë°œì ëª…í™•ì„±ì˜ ì¼ë¶€ ì¡°í•©ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤. ë‹¤ìŒì€ ì´ëŸ¬í•œ ì˜í–¥ì„ ìš”ì•½í•œ ê²ƒ.

> Legend:
 ğŸ”’ Security
 ğŸï¸ Build Speed
 ğŸ‘ï¸ Clarity
 
Pin specific versions [ğŸ”’ ğŸ‘ï¸]
 - base images (either major+minor OR SHA256 hash) [ğŸ”’ ğŸ‘ï¸]
 - stem Dependencies [ğŸ”’ ğŸ‘ï¸]
 - plication Dependencies [ğŸ”’ ğŸ‘ï¸]
 
Use small + secure base images [ğŸ”’ ğŸï¸]

Protect the layer cache [ğŸï¸ ğŸ‘ï¸]
 - Order commands by frequency of change [ğŸï¸]
 - COPY dependency requirements file â†’ install deps â†’ copy remaining source code [ğŸï¸]
 
- Use cache mounts [ğŸï¸]
- Use COPY --link [ğŸï¸]
- Combine steps that are always linked (use heredocs to improve tidiness) [ğŸï¸ ğŸ‘ï¸]

Be explicit [ğŸ”’ ğŸ‘ï¸]
- Set working directory with WORKDIR [ğŸ‘ï¸]
- Indicate standard port with EXPOSE [ğŸ‘ï¸]
- Set default environment variables with ENV [ğŸ”’ ğŸ‘ï¸]

Avoid unnecessary files [ğŸ”’ ğŸï¸ ğŸ‘ï¸]
- Use .dockerignore [ğŸ”’ ğŸï¸ ğŸ‘ï¸]
- COPY specific files [ğŸ”’ ğŸï¸ ğŸ‘ï¸]

Use non-root USER [ğŸ”’]

Install only production dependencies [ğŸ”’ ğŸï¸ ğŸ‘ï¸]

Avoid leaking sensitive information [ğŸ”’]

Leverage multi-stage builds [ğŸ”’ ğŸï¸]

 
## 2. ë² ì´ìŠ¤ ì´ë¯¸ì§€ ê³ ë¥´ê¸°

ì»¨í…Œì´ë„ˆì˜ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•  ë•Œ í¬ê¸°, ì–¸ì–´ ì§€ì›, ì¸ì²´ê³µí•™, ë³´ì•ˆê³¼ ê°™ì€ ìš”ì†Œë¥¼ ê³ ë ¤í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. ì´ëŸ¬í•œ ê³ ë ¤ ì‚¬í•­ì— ëŒ€í•´ ë…¼ì˜í•˜ê³  Node.js ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ëª‡ ê°€ì§€ ìƒ˜í”Œ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•´ë³´ì.

> ê³ ë ¤í•´ì•¼ í•  ìš”ì†Œë“¤


í¬ê¸°: ê¸°ë³¸ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆëŠ” ìµœì¢… ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆì˜ ì²˜ìŒ ê°’
&nbsp
ì–¸ì–´ì§€ì›: ê¸°ë³¸ì´ì§€ë¯¸ê°€ í•´ë‹¹ ì–¸ì–´ë¥¼ ì§€ì›í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
&nbsp
ì¸ì²´ê³µí•™:ì´ë¯¸ì§€ ì‘ì—…ì´ ì–¼ë§ˆë‚˜ ì‰¬ìš´ì§€, ë””ë²„ê¹…ì´ë‚˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ë¥¼ ìœ„í•œ ìœ í‹¸ë¦¬í‹°ê°€ ë‚´ì¥ë˜ì–´ ìˆëŠ”ì§€.
&nbsp
ë³´ì•ˆ: CVE(ì·¨ì•½ì ê³¼ ë…¸ì¶œì„±) ìˆ˜ì™€ ì´ë¯¸ì§€ì˜ ê³µê²© ë…¸ì¶œ ì˜ì—­ì„ ê³ ë ¤

> node.js ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ë³¸ì´ë¯¸ì§€ ì˜ˆì‹œ

![](https://velog.velcdn.com/images/luckyprice1103/post/0e1db1bf-495b-43ef-9122-d881211b80da/image.png)

ìœ„ ì‚¬ì§„ì€ node.js ì–´í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë³¸ì´ë¯¸ì§€ì™€ ê°ê°ì˜ ì·¨ì•½ì ê³¼ ì‚¬ì´ì¦ˆì— ëŒ€í•œ ì˜ˆì‹œì´ë‹¤.

1. node:latest (Bullseye) - Almost 1 GB in size, with 5 critical vulnerabilities, but easy to work with.

2. node:slim (Bullseye) - 4 times smaller than the full size image and eliminates critical vulnerabilities, but with fewer built-in utilities.

3. node:alpine - Small and free of CVEs, but considered experimental by Node.js due to its different C library variant.

4. gcr.io/distroless/nodejs - Security-focused image created by Google, with LTS Node.js support only and limited utilities.

5. cgr.dev/chainguard/node - Smallest and most secure image, but may be more difficult to work with due to its software provenance and limited package support.
