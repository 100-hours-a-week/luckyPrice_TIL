![](https://velog.velcdn.com/images/luckyprice1103/post/8f7464e3-4f4d-4172-b874-d131ef2275ee/image.png)

## 1. ë¦¬í”Œë¦¬ì¹´ì…‹

### ğŸš€ 1. yaml êµ¬ì¡°
``` yaml

apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: myreplicaset
spec:
  replicas: 2
  selector:
    matchLabels:
      run: nginx-rs
  template:
    metadata:
      labels:
        run: nginx-rs
    spec:
      containers:
      - name: nginx
        image: nginx
```

âœ” apiVersion: apps/v1 â†’ ReplicaSetì€ apps/v1 API ê·¸ë£¹ì„ ì‚¬ìš©í•´ì•¼ í•¨.
âœ” kind: ReplicaSet â†’ ReplicaSetì„ ìƒì„±í•˜ëŠ” ë§¤ë‹ˆí˜ìŠ¤íŠ¸.
âœ” metadata.name: myreplicaset â†’ ì´ ReplicaSetì˜ ì´ë¦„ì€ myreplicaset

âœ” replicas: 2 â†’ 2ê°œì˜ Podì„ ìœ ì§€í•˜ë„ë¡ ì„¤ì •ë¨
â¡ ë§Œì•½ Podì´ ì‚­ì œë˜ê±°ë‚˜ ì¥ì• ê°€ ë‚˜ë©´, ìë™ìœ¼ë¡œ ìƒˆë¡œìš´ Podì„ ìƒì„±í•´ì„œ í•­ìƒ 2ê°œ ìœ ì§€

âœ” selector.matchLabels.run: nginx-rs
â¡ ReplicaSetì´ Podì„ ê´€ë¦¬í•  ë•Œ, ì´ ë¼ë²¨ì´ ìˆëŠ” Podë§Œ ê´€ë¦¬í•¨.
â¡ ì¦‰, run=nginx-rs ë¼ë²¨ì´ ìˆëŠ” Podì´ 2ê°œ ì´í•˜ì´ë©´ ìƒˆë¡œ ìƒì„±í•˜ê³ , 2ê°œë³´ë‹¤ ë§ìœ¼ë©´ ì‚­ì œí•¨.

âœ” template.metadata.labels.run: nginx-rs
â¡ ìƒˆë¡­ê²Œ ìƒì„±ë  Podì—ë„ run=nginx-rs ë¼ë²¨ì„ ìë™ìœ¼ë¡œ ë¶™ì„.
â¡ ìœ„ selector.matchLabels.run: nginx-rsê³¼ ì¼ì¹˜í•´ì•¼ í•¨.

ğŸ“Œ ğŸ’¡ ì£¼ì˜:
selector.matchLabelsê³¼ template.metadata.labelsëŠ” ë°˜ë“œì‹œ ì¼ì¹˜í•´ì•¼ í•¨!
âœ” ë§Œì•½ ë‹¤ë¥´ë©´ ReplicaSetì´ Podì„ ì œëŒ€ë¡œ ê´€ë¦¬í•  ìˆ˜ ì—†ìŒ.


### ğŸš€ 2. ReplicaSet ë™ì‘ ë°©ì‹
ğŸ”¹ ReplicaSetì´ í•˜ëŠ” ì¼
1ï¸âƒ£ ì²˜ìŒ ë°°í¬ë˜ë©´ 2ê°œì˜ Podì´ ìë™ ìƒì„±ë¨.
2ï¸âƒ£ ë§Œì•½ Podì´ 1ê°œ ì‚¬ë¼ì§€ë©´, ìƒˆë¡œìš´ Podì„ 1ê°œ ë” ìƒì„±í•˜ì—¬ 2ê°œë¥¼ ìœ ì§€í•¨.
3ï¸âƒ£ ë§Œì•½ Podì´ 3ê°œ ì´ìƒì´ë©´, 1ê°œë¥¼ ìë™ ì‚­ì œí•˜ì—¬ 2ê°œë§Œ ìœ ì§€í•¨.

ğŸ“Œ ReplicaSetì´ ë³´ì¥í•˜ëŠ” ê²ƒ:
âœ” ì„¤ì •í•œ replicas: 2 ê°œìˆ˜ë§Œí¼ í•­ìƒ ìœ ì§€
âœ” Podì´ ì‚¬ë¼ì§€ë©´ ìë™ìœ¼ë¡œ ë³µêµ¬
âœ” Podì´ ë§ì•„ì§€ë©´ ìë™ìœ¼ë¡œ ì¡°ì ˆ



### 3. ë™ì‘ ì˜ˆì‹œ

``` bash
kubectl apply -f myreplicaset.yaml
```
![](https://velog.velcdn.com/images/luckyprice1103/post/a150b2a8-4c73-4405-abbb-8b02018d8a8e/image.png)

replicaë¥¼ í™•ì¥ ì‹œ.

```
kubectl scale rs --replicas <number> <name>
```


![](https://velog.velcdn.com/images/luckyprice1103/post/4b9d0e42-5f05-4e4f-b0a4-42b91ff8653b/image.png)

podê°€ 4ê°œê°€ ë¨.
ì§€ìš°ë”ë¼ë„ ë ˆí”Œë¦¬ì¹´ì— 4ê°œì˜ podë¥¼ ë„ì›Œë‹¬ë¼ í–ˆê¸° ë•Œë¬´ë„¤ ë‹¤ì‹œ ì‚´ì•„ë‚¨.


## 2. ë””í”Œë¡œì´ë¨¼íŠ¸


``` yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mydeploy
spec:
  replicas: 10
  selector:
    matchLabels:
      run: nginx
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 25%  
      maxSurge: 25%
  template:
    metadata:
      labels:
        run: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.7.9
```

1. ê°œìš”
ì´ DeploymentëŠ” nginx:1.7.9 ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ë©°, ë¡¤ë§ ì—…ë°ì´íŠ¸ ì „ëµì„ ì‚¬ìš©í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

2. ì£¼ìš” êµ¬ì„± ìš”ì†Œ

(1) apiVersion ë° kind

``` yaml
apiVersion: apps/v1
kind: Deployment
apiVersion: apps/v1 â†’ Kubernetesì˜ Deployment ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” API ë²„ì „.
```

kind: Deployment â†’ ì´ ë¦¬ì†ŒìŠ¤ê°€ Deploymentì„ì„ ì˜ë¯¸.
(2) metadata

```yaml
metadata:
name: mydeploy
name: mydeploy â†’ Deploymentì˜ ì´ë¦„ì„ mydeployë¡œ ì§€ì •.
```

(3) spec (Deployment ìŠ¤í™)
(a) replicas
```yaml
replicas: 10
replicas: 10 â†’ Nginx íŒŒë“œë¥¼ 10ê°œ ìƒì„±.
```


(b) selector

```yaml
selector:
  matchLabels:
    run: nginx
```
matchLabels: run: nginx â†’ run=nginx ë ˆì´ë¸”ì„ ê°€ì§„ íŒŒë“œë“¤ì„ ê´€ë¦¬.
(c) strategy (ë°°í¬ ì „ëµ)

```yaml
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 25%  
    maxSurge: 25%
```
type: RollingUpdate â†’ ê¸°ì¡´ íŒŒë“œë¥¼ ì ì§„ì ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ë¡¤ë§ ì—…ë°ì´íŠ¸ ë°©ì‹ ì‚¬ìš©.
maxUnavailable: 25%


ê¸°ì¡´ íŒŒë“œ ì¤‘ í•œ ë²ˆì— ìµœëŒ€ 25%ê¹Œì§€ ì œê±° ê°€ëŠ¥.
ì¦‰, replicas=10ì´ë¯€ë¡œ ìµœëŒ€ 2ê°œ(10 * 25%)ê¹Œì§€ ì‚­ì œ ê°€ëŠ¥.
maxSurge: 25%
ì¶”ê°€ë¡œ ìƒì„±í•  ìˆ˜ ìˆëŠ” íŒŒë“œì˜ ìµœëŒ€ ë¹„ìœ¨ì„ 25%ë¡œ ì„¤ì •.
ì¦‰, replicas=10ì´ë¯€ë¡œ ìµœëŒ€ 2ê°œê¹Œì§€ ì´ˆê³¼ ìƒì„± ê°€ëŠ¥.
âœ… ê²°ê³¼ì ìœ¼ë¡œ, í•œ ë²ˆì— ìµœëŒ€ 12ê°œ íŒŒë“œê¹Œì§€ ìš´ì˜ë˜ë©°, ìµœì†Œ 8ê°œ íŒŒë“œëŠ” í•­ìƒ ìœ ì§€ë¨.

(d) template (íŒŒë“œ í…œí”Œë¦¿)

```yaml
template:
  metadata:
    labels:
      run: nginx
```
labels: run: nginx â†’ ìƒì„±ë˜ëŠ” ëª¨ë“  íŒŒë“œì— run=nginx ë ˆì´ë¸”ì´ ë¶™ìŒ.
ì´ëŠ” selector.matchLabelsì™€ ì¼ì¹˜í•´ì•¼ í•¨.

(e) spec (ì»¨í…Œì´ë„ˆ ì •ì˜)

``` yaml
spec:
  containers:
  - name: nginx
    image: nginx:1.7.9
```
    
    
name: nginx â†’ ì»¨í…Œì´ë„ˆ ì´ë¦„ì„ nginxë¡œ ì„¤ì •.
image: nginx:1.7.9 â†’ nginxì˜ 1.7.9 ë²„ì „ ì‚¬ìš©.


![](https://velog.velcdn.com/images/luckyprice1103/post/cef44801-b5bd-4569-a9ed-ea1337dd8e6c/image.png)

![](https://velog.velcdn.com/images/luckyprice1103/post/d92db95f-9608-41ba-babf-62f2c387ee23/image.png)


ì•„ë¯¸ì§€ ì£¼ì†Œ ë³€ê²½.

```yaml
 kubectl set image deployment mydeploy nginx=nginx:latest --
```


![](https://velog.velcdn.com/images/luckyprice1103/post/eba7b51a-1df0-47df-a495-36ea1a7f92b2/image.png)


ë³µì œë³¸ ê°œìˆ˜ ì¡°ì ˆ
```yaml
kubectl scale deployment --replicas 5 #
```

![](https://velog.velcdn.com/images/luckyprice1103/post/5ccdc38d-4627-47b7-913b-118a7b40a0fb/image.png)

