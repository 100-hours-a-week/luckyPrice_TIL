# 1. ë©€í‹°ë…¸ë“œ Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì¶•



![](https://velog.velcdn.com/images/luckyprice1103/post/b31cd8a4-f97a-46b1-8357-64ee6b896080/image.png)




## 1. ë…¸ë“œ ìƒì„±.
### 1. ec2 í…œí”Œë¦¿ ìƒì„±

ì›ë˜ëŠ” ec2ì— ì¿ ë²„ë„¤í‹°ìŠ¤, ë„ì»¤ ê´€ë ¨ ì„¤ì¹˜ë¥¼ ê°ê° í•´ì•¼í•˜ì§€ë§Œ, í…œí”Œë¦¿ì„ ì´ìš©í•˜ì—¬ ê°„ì†Œí™” í•´ë³´ë„ë¡ í•¨.

![](https://velog.velcdn.com/images/luckyprice1103/post/90cac7cf-8b0d-44d9-af42-cc8be23f1825/image.png)

ìš´ì˜ì²´ì œ -> ubuntu 22.04
ì¸ìŠ¤í„´ìŠ¤ ìœ í˜• -> t3.medium
ìŠ¤í† ë¦¬ì§€ -> ebs gp2, 30gb


ì‚¬ìš©ì ë°ì´í„°ì— ì„¤ì • íŒŒì¼ ì…ë ¥.
![](https://velog.velcdn.com/images/luckyprice1103/post/cafa321e-11d3-417c-874b-ad4ad36d0c48/image.png)

```bash
#!/bin/bash
set -eux  # ì—ëŸ¬ ë°œìƒ ì‹œ ì¤‘ë‹¨ & ë””ë²„ê¹…ìš© ì¶œë ¥ í™œì„±í™”

# âœ… íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt-get update -y

# âœ… Swap ë¹„í™œì„±í™” (ì¬ë¶€íŒ… í›„ì—ë„ ìœ ì§€)
sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab

# âœ… Swap ë©”ëª¨ë¦¬ ë¹„í™œì„±í™” í™•ì¸
free -h

# âœ… í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt-get install -y ca-certificates curl apt-transport-https gpg

# âœ… Docker GPG í‚¤ ì¶”ê°€
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# âœ… Docker ì €ì¥ì†Œ ì¶”ê°€ ë° ì„¤ì¹˜
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo systemctl enable --now docker


# âœ… Containerd ê´€ë ¨ ëª¨ë“ˆ ì„¤ì • (ì¬ë¶€íŒ… í›„ì—ë„ ìœ ì§€ë¨)
cat <<EOF | sudo tee /etc/modules-load.d/containerd.conf
overlay
br_netfilter
EOF
sudo modprobe overlay
sudo modprobe br_netfilter

# âœ… Containerd ë„¤íŠ¸ì›Œí¬ ì„¤ì • (Kubernetesì™€ í˜¸í™˜ë˜ë„ë¡ ìˆ˜ì •)
sudo modprobe overlay
sudo modprobe br_netfilter
cat <<EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
net.bridge.bridge-nf-call-iptables=1
net.ipv4.ip_forward=1
net.bridge.bridge-nf-call-ip6tables=1
EOF
sudo sysctl --system

# âœ… containerd ì„¤ì • íŒŒì¼ ìˆ˜ì •
sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml > /dev/null
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml
sudo systemctl restart containerd

# âœ… Kubernetes GPG í‚¤ ì¶”ê°€
sudo curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

# âœ… Kubernetes ì €ì¥ì†Œ ì¶”ê°€
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list

# âœ… Kubernetes ì„¤ì¹˜ (kubeadm, kubelet, kubectl)
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl  # ë²„ì „ ê³ ì •

# âœ… ì„¤ì¹˜ ì™„ë£Œ ë©”ì‹œì§€ ì¶œë ¥
echo " Kubernetes & Docker launch complete now you can use them
```


ìƒì„± ì™„ë£Œ....!
![](https://velog.velcdn.com/images/luckyprice1103/post/240f18e7-4c60-4302-99b8-c6011708f3ac/image.png)




### 2. hostnameë³€ê²½
sudo su
sudo hostnamectl set-hostname kcontrolplane
sudo hostnamectl set-hostname worker01
sudo hostnamectl set-hostname worker02

### 3. ì„¤ì¹˜ í™•ì¸.

sudo kubeadm init
#ëª¨ë“  terminal windowë§ˆë‹¤í•´ì•¼í•¨
export KUBECONFIG=/etc/kubernetes/admin.conf

ğŸ’¡ ë§Œì•½ permission denied ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, ì•„ë˜ ê¶Œí•œ ë³€ê²½ ì¶”ê°€
sudo chown $(id -u):$(id -g) /etc/kubernetes/admin.conf


- kcontrolplane
![](https://velog.velcdn.com/images/luckyprice1103/post/0fbec979-25dd-46fd-8354-374830556e61/image.png)


- worker node01
![](https://velog.velcdn.com/images/luckyprice1103/post/7dd056d8-a8c6-426d-8675-605ec99e399f/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/c04fdfd6-ee6f-4318-a6f1-1682a0d1af2a/image.png)



- worker node02
![](https://velog.velcdn.com/images/luckyprice1103/post/b8c74097-4f78-43cf-8921-eac5bc7d9a76/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/77b5d79f-f2d5-49f6-9a3d-f7c5ec3cb16e/image.png)

ğŸš€ Worker ë…¸ë“œì—ì„œ kubectl version ì‹¤í–‰ ì‹œ "The connection to the server localhost:8080 was refused" ì˜¤ë¥˜ -> ì •ìƒ

Worker ë…¸ë“œì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ kubectlì„ ì‹¤í–‰í•´ë„ Kubernetes API ì„œë²„(6443 í¬íŠ¸)ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸.

Worker ë…¸ë“œì—ëŠ” Kubernetes Control Plane(API Server, etcd ë“±)ì´ ì—†ìŒ ê¸°ë³¸ì ìœ¼ë¡œ kubectlì€ localhost:8080ì„ API ì„œë²„ë¡œ ì¸ì‹í•˜ì§€ë§Œ, Worker ë…¸ë“œì—ëŠ” API ì„œë²„ê°€ ì—†ì–´ì„œ ì—°ê²°ì´ ì‹¤íŒ¨ Worker ë…¸ë“œì—ì„œ kubectlì„ ì‹¤í–‰í•˜ë ¤ë©´ Control Planeì˜ kubeconfig íŒŒì¼ì„ ë³µì‚¬í•´ì•¼ í•¨

## 2. worker ë…¸ë“œë¥¼ Control Planeì— ì¶”ê°€.


kcontrolplaneì—ì„œ join message ë³µì‚¬ í•´ì„œ workerë¡œ

==========worker =================================

sudoÂ kubeadm join 192.168.35.50:6443 --token hm6os1.qoi3qn1hecpqx6pl --discovery-token-ca-cert-hash sha256:efe798a7234e5e3b6
![](https://velog.velcdn.com/images/luckyprice1103/post/3d2c1bd2-d4d7-49a3-bda7-938d9f3580b1/image.png)

- ì—ëŸ¬
![](https://velog.velcdn.com/images/luckyprice1103/post/ed3f5795-62ee-4edc-9f38-fd6fc3330676/image.png)


AWS ë³´ì•ˆ ê·¸ë£¹ì€ ê¸°ë³¸ì ìœ¼ë¡œ ìê¸° ìì‹ (SG ë‚´ë¶€ í†µì‹ )ì„ ìë™ìœ¼ë¡œ í—ˆìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í—ˆìš©í•´ì¤˜ì•¼í•¨.

![](https://velog.velcdn.com/images/luckyprice1103/post/7091d5d6-431f-46d0-b033-584186db1fca/image.png)

- ì„±ê³µ.
![](https://velog.velcdn.com/images/luckyprice1103/post/a8bc3760-5e3b-4e83-bfb0-f4cc8565a494/image.png)

![](https://velog.velcdn.com/images/luckyprice1103/post/5017fd06-9c96-4fc7-b062-ecf126641508/image.png)

 ì´ì œ Worker01, Worker02 ë…¸ë“œê°€ ì •ìƒì ìœ¼ë¡œ Control Planeì— í•©ë¥˜ë¨
 
 ![](https://velog.velcdn.com/images/luckyprice1103/post/90e74db2-2281-4217-9ea9-71beb23e69a5/image.png)


## 3. network ì„¤ì¹˜

 ì´ ë‹¨ê³„ì—ì„œëŠ” Kubernetes ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ ì ìš©í•˜ê³ , kubectlì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ ì ê²€.

==========master =================================

### 1. ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸(Calico) ì ìš©
#user
```bash
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

![](https://velog.velcdn.com/images/luckyprice1103/post/e02f7074-9e42-44fd-b59b-78b6cd39875b/image.png)
âœ… ì´ ì½”ë“œê°€ í•˜ëŠ” ì¼:

Control Planeì—ì„œ ê´€ë¦¬ì(Admin) ê¶Œí•œìœ¼ë¡œ kubectlì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ Kubeconfig ì„¤ì •ì„ ë³µì‚¬í•˜ëŠ” ê³¼ì •
/etc/kubernetes/admin.conf íŒŒì¼ì„ í˜„ì¬ ì‚¬ìš©ì($HOME/.kube/config)ë¡œ ë³µì‚¬
kubectlì´ ì´ ì„¤ì •ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì„œ Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •



#root


```bash
export KUBECONFIG=/etc/kubernetes/admin.conf
kubectl apply -f https://docs.projectcalico.org/v3.25/manifests/calico.yaml
```

![](https://velog.velcdn.com/images/luckyprice1103/post/e5843cbf-189c-46c0-aff2-9e38ea6f50f5/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/a010ef8e-5ede-44bf-946d-76a5ed4fae59/image.png)

âœ… ì´ ì½”ë“œê°€ í•˜ëŠ” ì¼:

kubectlì´ ê¸°ë³¸ì ìœ¼ë¡œ /etc/kubernetes/admin.confë¥¼ ì‚¬ìš©í•˜ë„ë¡ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
í˜„ì¬ í„°ë¯¸ë„ ì„¸ì…˜ì—ì„œë§Œ ì ìš©ë¨ (í„°ë¯¸ë„ì„ ë‹«ìœ¼ë©´ ì„¤ì •ì´ ì‚¬ë¼ì§)
ğŸ’¡ ì´ ì„¤ì •ì´ ì—†ìœ¼ë©´?

kubectlì„ ì‹¤í–‰í•˜ë©´ Kubernetes API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ì–´ì„œ kubectl get nodes ê°™ì€ ëª…ë ¹ì–´ê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ

## í´ëŸ¬ìŠ¤í„° ë™ì‘ í™•ì¸


```bash
kubectl get pods -A
```
![](https://velog.velcdn.com/images/luckyprice1103/post/91dc17fc-772a-44bb-aa92-9af28d7442a8/image.png)

âœ” ëª¨ë“  ì‹œìŠ¤í…œ ê´€ë ¨ Podê°€ Running ìƒíƒœì¸ì§€ í™•ì¸
âœ” íŠ¹íˆ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” calico, kube-proxyê°€ ì •ìƒ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸


```bash
kubectl get nodes
```

![](https://velog.velcdn.com/images/luckyprice1103/post/f90d4ecc-7dbf-423e-a36a-36f8c3edf4b3/image.png)

âœ” ëª¨ë“  ë…¸ë“œê°€ Ready ìƒíƒœë¼ë©´ í´ëŸ¬ìŠ¤í„° ì •ìƒ ì‘ë™ ğŸ‰(NotReady->Ready)




# 2. ë©€í‹° ë…¸ë“œ í´ëŸ¬ìŠ¤í„°ì—ì„œ Prometheus + Grafana ëª¨ë‹ˆí„°ë§ êµ¬ì¶•



[ë©€í‹°ë…¸ë“œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶•.](https://velog.io/@luckyprice1103/%EB%A9%80%ED%8B%B0%EB%85%B8%EB%93%9C-Kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%B6%95)

âœ… ëª©í‘œ:

Prometheus + Grafanaë¥¼ Kubernetes í´ëŸ¬ìŠ¤í„°ì— ë°°í¬
í´ëŸ¬ìŠ¤í„°ì˜ CPU, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ì‹œê°í™”
Helmì„ ì‚¬ìš©í•˜ì—¬ ê°„í¸í•˜ê²Œ ì„¤ì¹˜

âœ… êµ¬ì„± ìš”ì†Œ:

Prometheus: Kubernetesì˜ ë©”íŠ¸ë¦­ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
Grafana: Prometheusì—ì„œ ìˆ˜ì§‘í•œ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ëŠ” ëŒ€ì‹œë³´ë“œ


## 1. Helm ì„¤ì¹˜ (Helm íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ì‚¬ìš©)
ğŸ”¹ Helmì´ë€?

Kubernetesì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°„í¸í•˜ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” íŒ¨í‚¤ì§€ ê´€ë¦¬ ë„êµ¬
Prometheus + Grafanaë¥¼ Helm Chartë¡œ ì‰½ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŒ

ğŸ”¹ Helm ì„¤ì¹˜:
Control Planeì—ì„œ ì‹¤í–‰
``` bash
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

helm version

```



## 2. Prometheus + Grafanaë¥¼ Helmìœ¼ë¡œ ì„¤ì¹˜
ğŸ”¹ Helmì„ ì‚¬ìš©í•˜ì—¬ Prometheus & Grafana Chart ì €ì¥ì†Œ ì¶”ê°€
```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
```
âœ” prometheus-communityë¼ëŠ” Helm Chart ì €ì¥ì†Œê°€ ì¶”ê°€ë¨


ğŸ”¹ Prometheus + Grafana ë°°í¬
```bash
helm install monitoring prometheus-community/kube-prometheus-stack --namespace monitoring --create-namespace

```
![](https://velog.velcdn.com/images/luckyprice1103/post/f776fae3-296c-4a6f-830d-93aaeae2c2c5/image.png)


âœ… ì´ ëª…ë ¹ì–´ê°€ í•˜ëŠ” ì¼:

Prometheus + Grafanaë¥¼ monitoring ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë°°í¬
kube-prometheus-stack Chartë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes í´ëŸ¬ìŠ¤í„° ëª¨ë‹ˆí„°ë§


âœ” ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸:

``` bash
kubectl get pods -n monitoring

```
![](https://velog.velcdn.com/images/luckyprice1103/post/eb474ffa-af35-426f-ae7b-a1b815077a6f/image.png)
âœ… Running ìƒíƒœë©´ ì„±ê³µì ìœ¼ë¡œ ë°°í¬ëœ ê²ƒ! ğŸ‰


## 3. Grafanaì— ì ‘ì†í•˜ì—¬ í´ëŸ¬ìŠ¤í„° ëª¨ë‹ˆí„°ë§

### 1. í¬íŠ¸ 3000 ì›¹ ì ‘ì†
ğŸ”¹ Grafanaë¥¼ í¬íŠ¸ í¬ì›Œë”©í•˜ì—¬ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸°
``` bash
kubectl port-forward svc/monitoring-grafana 3000:80 -n monitoring
```
âœ… í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ Grafana(í¬íŠ¸ 80)ë¥¼ ë¡œì»¬ ì»´í“¨í„°ì˜ localhost:3000ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í¬íŠ¸ í¬ì›Œë”©í•˜ëŠ” ì—­í• ì„ í•¨.



âœ… ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì† ì‹œë„:

![](https://velog.velcdn.com/images/luckyprice1103/post/e83ab11f-7ae6-4686-99d3-d0d380eba1f4/image.png)
ğŸ”¹ ì—°ê²° ì‹¤íŒ¨.

kubectl port-forwardëŠ” ë¡œì»¬ ë¨¸ì‹ ì—ì„œë§Œ ì ‘ì† ê°€ëŠ¥. kubectl port-forwardëŠ” ì˜¤ì§ localhost(127.0.0.1)ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥!
ì¦‰, í¼ë¸”ë¦­ IP(ì˜ˆ: 3.39.236.1:3000 ë¡œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ!)

ğŸ’¡ í•´ê²° ë°©ë²•:

SSH í„°ë„ë§ì„ ì´ìš©í•´ì„œ ë¡œì»¬ì—ì„œ ì ‘ì†í•˜ê¸°

=================ë‚´ ë¡œì»¬ ì»´í“¨í„°=======================
``` bash
ssh -L 3000:localhost:3000 -N -f -i kakao_key.pem ubuntu@ec2-3-39-236-1.ap-northeast-2.compute.amazonaws.com
```
![](https://velog.velcdn.com/images/luckyprice1103/post/80f57b13-3302-458f-89c8-7a6d8958122d/image.png)


ğŸ”¹ë‹¤ì‹œ ì ‘ì† ì‹œë„. (ë‚´ ë¡œì»¬ ì»´í“¨í„°ì˜ localhost:3000)
âœ… ì´ì œ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì† ì„±ê³µ:

![](https://velog.velcdn.com/images/luckyprice1103/post/fc878426-c502-416b-a686-3a7b3177dd85/image.png)

ğŸ”¹ Grafana ê¸°ë³¸ ë¡œê·¸ì¸ ì •ë³´:

Username: admin
Password: prom-operator (ê¸°ë³¸ê°’)


### 2. í´ëŸ¬ìŠ¤í„° ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸

âœ” ë¡œê·¸ì¸ í›„ "Add Data Source" â†’ "Prometheus" ì„ íƒ
âœ” Prometheus ì£¼ì†Œë¥¼ http://monitoring-prometheus-kube-prometheus:9090ë¡œ ì„¤ì •
![](https://velog.velcdn.com/images/luckyprice1103/post/da0fddb8-8d9d-4c3f-a7a3-e4229a18b7ba/image.png)


1ï¸âƒ£ Grafana ì™¼ìª½ ë©”ë‰´ì—ì„œ ğŸ“Š Dashboards â†’ Import í´ë¦­
2ï¸âƒ£ ê³µì‹ Kubernetes ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ID ì…ë ¥

ëŒ€ì‹œë³´ë“œ ID: 315 (Kubernetes í´ëŸ¬ìŠ¤í„° ëª¨ë‹ˆí„°ë§)
ë˜ëŠ” 1860 (Kubernetes Node Exporter)
3ï¸âƒ£ "Load" ë²„íŠ¼ í´ë¦­
4ï¸âƒ£ "Prometheus" ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ
5ï¸âƒ£ "Import" ë²„íŠ¼ í´ë¦­
âœ… ì´ì œ Kubernetes í´ëŸ¬ìŠ¤í„°ì˜ ì „ì²´ì ì¸ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥...! ğŸ‰

![](https://velog.velcdn.com/images/luckyprice1103/post/b46f656a-8312-4317-b5c1-c1175311f171/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/7e2f64dd-580e-4787-bd38-2a85d93b896c/image.png)


## 4. í´ëŸ¬ìŠ¤í„° ë¶€í•˜ í…ŒìŠ¤íŠ¸

### 1. BusyBoxë¥¼ ì‚¬ìš©í•˜ì—¬ CPU ë¶€í•˜ ë°œìƒ
ğŸ“Œ Control Planeì—ì„œ ì‹¤í–‰:
```bash
kubectl run cpu-stress --image=busybox --restart=Never -- /bin/sh -c "while true; do echo 'stressing CPU'; done"

```
âœ… ì´ PodëŠ” ì¢…ë£Œë˜ì§€ ì•Šê³  ê³„ì†í•´ì„œ CPU ë¶€í•˜ë¥¼ ë°œìƒì‹œí‚´.

ğŸ”¹ ì‹¤í–‰ëœ Pod í™•ì¸:

```
kubectl get pods
```
ğŸ”¹ íŠ¹ì • Podì˜ ë¡œê·¸ í™•ì¸ (CPU ë¶€í•˜ê°€ ì§€ì†ì ìœ¼ë¡œ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸)

```
kubectl logs cpu-stress
```
âœ” CPU ë¶€í•˜ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ë ¤ë©´ Prometheus + Grafana ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸!
![](https://velog.velcdn.com/images/luckyprice1103/post/e37fc02a-95a8-43a5-be94-8e74e7d2a605/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/0f4f2fb0-e0d8-45a0-a3c8-82059e2f36d7/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/859509ca-7634-4fd5-886a-b7752a34f87a/image.png)

âœ… ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ:

```
kubectl delete pod cpu-stress
```


### 2. ë©€í‹°ë…¸ë“œì—ì„œ HTTP ë¶€í•˜ í…ŒìŠ¤íŠ¸ (k6 ì‚¬ìš©)
âœ… ëª©í‘œ:

ì—¬ëŸ¬ Worker ë…¸ë“œì—ì„œ HTTP ìš”ì²­ì„ ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ì—¬ ì‹¤ì œ íŠ¸ë˜í”½ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì§„í–‰
k6ëŠ” Kubernetesì—ì„œ ì—¬ëŸ¬ Podë¡œ ë°°í¬ ê°€ëŠ¥í•˜ì—¬ ë©€í‹°ë…¸ë“œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

âœ” 1) k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  Deployment ìƒì„±

- k6-deployment.yaml
```bash
apiVersion: apps/v1
kind: Deployment
metadata:
  name: k6-load-test
spec:
  replicas: 3  # ì—¬ëŸ¬ Worker ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •
  selector:
    matchLabels:
      app: k6
  template:
    metadata:
      labels:
        app: k6
    spec:
      containers:
      - name: k6
        image: grafana/k6
        args: ["run", "-u", "50", "-d", "60s", "https://nginx:80"]

```

ğŸ“Œ ì ìš©:


```bash
kubectl apply -f k6-deployment.yam
```

âœ… ì„¤ëª…:

replicas: 3 â†’ 3ê°œì˜ Podê°€ ì—¬ëŸ¬ Worker ë…¸ë“œì—ì„œ ë°°í¬ë˜ë©° HTTP ë¶€í•˜ë¥¼ ë¶„ì‚° ìƒì„±
-u 50 â†’ ë™ì‹œ 50ëª…ì˜ ì‚¬ìš©ì(virtual users) ìƒì„±
-d 60s â†’ 60ì´ˆ ë™ì•ˆ HTTP ìš”ì²­ì„ ì§€ì†ì ìœ¼ë¡œ ìˆ˜í–‰

![](https://velog.velcdn.com/images/luckyprice1103/post/52e71d70-4369-45e0-b6a1-7ecc363a56ec/image.png)


![](https://velog.velcdn.com/images/luckyprice1103/post/98691c5e-bc23-4705-89db-2f3c9c89f58d/image.png)![](https://velog.velcdn.com/images/luckyprice1103/post/7646d1eb-2b3f-47c2-b05b-3f3d8241eeb1/image.png)


kubectl delete deployment k6-load-test
