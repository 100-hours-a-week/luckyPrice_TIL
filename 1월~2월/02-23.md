## 1ë‹¨ê³„: ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ë° ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
ëª©í‘œ:
ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•˜ê³ , ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ìœ¼ë¡œ ë°°í¬í•œ í›„, ì„œë¹„ìŠ¤(Service) ì„¤ì •ì„ í†µí•´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±


âœ… ìˆ˜í–‰ ê³¼ì •
ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° êµ¬ì¶•



### 1. AWS EC2 ê¸°ë°˜ì˜ ë©€í‹°ë…¸ë“œ í´ëŸ¬ìŠ¤í„° Kubeadm êµ¬ì¶•

[ë©€í‹° ë…¸ë“œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶•.](https://velog.io/@luckyprice1103/%EB%A9%80%ED%8B%B0%EB%85%B8%EB%93%9C-Kubernetes-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%B6%95)

ë…¸ë“œ í™•ì¥ì„ ê³ ë ¤í•œ êµ¬ì¡° ì„¤ê³„ ë° ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

âœ… 1. ë…¸ë“œ í™•ì¥ ê³ ë ¤ ì—¬ë¶€ ì ê²€
![](https://velog.velcdn.com/images/luckyprice1103/post/2447f1e7-e142-47b6-a555-a0550cd0ed4b/image.png)


âœ… 2. ë„¤íŠ¸ì›Œí¬ êµ¬ì„± ê²€í†  ë° ìµœì í™”
![](https://velog.velcdn.com/images/luckyprice1103/post/fe628311-7b44-429f-93ea-b9310c9965fd/image.png)




### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ ë°°í¬

ê°œë°œíŒ€ì—ì„œ ì œê³µí•œ Nginx ë˜ëŠ” Node.js ê¸°ë°˜ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë°°í¬
Deployment ìƒì„± ë° ë‹¤ì¤‘ íŒŒë“œ ë°°í¬

(1) Deployment ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì‘ì„±
Deploymentë¥¼ ì´ìš©í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ìœ¼ë¡œ ë°°í¬.

(app-deployment.yaml)

``` yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-web-app
  labels:
    app: my-web-app
spec:
  replicas: 3  # 3ê°œì˜ íŒŒë“œë¥¼ ìƒì„±
  selector:
    matchLabels:
      app: my-web-app
  template:
    metadata:
      labels:
        app: my-web-app
    spec:
      containers:
        - name: my-web-app
          image: nginx:latest  # ê°œë°œíŒ€ ì œê³µ ì´ë¯¸ì§€ ì‚¬ìš© ê°€ëŠ¥
          ports:
            - containerPort: 80
          resources:
            requests:
              cpu: "100m"
              memory: "128Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
```

replicas: 3 â†’ íŒŒë“œë¥¼ 3ê°œ ë°°í¬í•˜ì—¬ ë¶€í•˜ë¥¼ ë¶„ì‚°
image: nginx:latest â†’ ìµœì‹  Nginx ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©
containerPort: 80 â†’ ì›¹ ì„œë¹„ìŠ¤ í¬íŠ¸ ì„¤ì •
resources â†’ CPU ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì„¤ì • (ì ì ˆí•œ ê°’ìœ¼ë¡œ ì¡°ì • ê°€ëŠ¥)

- t3.mediumì˜ ê¸°ë³¸ì ì¸ ìŠ¤í™:
vCPU: 2ê°œ
RAM: 4GB (4096Mi)
ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥: ì¤‘ê°„
EBS ëŒ€ì—­í­: 5Gbps
ë‘ ê°œì˜ ì›Œì»¤ ë…¸ë“œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì´ ê°€ìš© ìì›ì€:
CPU: 2vCPU Ã— 2 = 4vCPU
ë©”ëª¨ë¦¬: 4GB Ã— 2 = 8GB



- ê° íŒŒë“œì˜ ìµœì†Œ ìš”êµ¬ëŸ‰(Requests)
CPU: 100m (0.1 vCPU)
ë©”ëª¨ë¦¬: 128Mi
- ê° íŒŒë“œì˜ ìµœëŒ€ ì‚¬ìš© ê°€ëŠ¥ëŸ‰(Limits)
CPU: 500m (0.5 vCPU)
ë©”ëª¨ë¦¬: 512Mi

- 3ê°œì˜ íŒŒë“œê°€ ìµœì†Œ ìš”êµ¬ëŸ‰ë§Œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
CPU: 100m Ã— 3 = 300m (0.3 vCPU)
ë©”ëª¨ë¦¬: 128Mi Ã— 3 = 384Mi
ğŸ’¡ ì´ ê²½ìš°, t3.medium ë…¸ë“œ í•˜ë‚˜(2 vCPU, 4GB)ë¡œ ì¶©ë¶„íˆ ê°ë‹¹ ê°€ëŠ¥
ğŸ’¡ ì¦‰, í•˜ë‚˜ì˜ ë…¸ë“œì—ì„œë„ ì¶©ë¶„íˆ ìš´ì˜ ê°€ëŠ¥í•˜ë©°, ë‘ ê°œì˜ ë…¸ë“œê°€ ìˆë‹¤ë©´ ì—¬ìœ ë¡­ê²Œ ìš´ì˜ë¨

- 3ê°œì˜ íŒŒë“œê°€ ìµœëŒ€ Limitsê¹Œì§€ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
CPU: 500m Ã— 3 = 1500m (1.5 vCPU)
ë©”ëª¨ë¦¬: 512Mi Ã— 3 = 1536Mi
ğŸ’¡ t3.medium í•˜ë‚˜ì˜ 2 vCPUì™€ 4GB ë‚´ì—ì„œ ìš´ì˜ ê°€ëŠ¥
ğŸ’¡ ë…¸ë“œê°€ 2ê°œì´ë¯€ë¡œ ì´ 4 vCPU / 8GB ë©”ëª¨ë¦¬ë¡œ ì¶©ë¶„í•œ ì—¬ìœ  ê³µê°„ í™•ë³´

(2) Deployment ë°°í¬.

``` bash
kubectl apply -f app-deployment.yaml
```
![](https://velog.velcdn.com/images/luckyprice1103/post/193aaf80-280c-4f11-8413-e266b5ce769e/image.png)


kubectl scale ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ replicas ê°œìˆ˜ë¥¼ ì¡°ì •


``` bash
kubectl scale deployment my-web-app --replicas=4
```

![](https://velog.velcdn.com/images/luckyprice1103/post/a6b8e6ce-7625-473e-894e-415b6a385255/image.png)
-> 4ê°œë¡œ ëŠ˜ì–´ë‚¨.

### 3. ì„œë¹„ìŠ¤ ì„¤ì • ë° íŠ¸ë˜í”½ ê´€ë¦¬

ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ìœ„í•œ Service (LoadBalancer / Ingress) ì„¤ì •
ì™¸ë¶€ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì ‘ê·¼ í…ŒìŠ¤íŠ¸ ë° ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ í•´ê²°

service-nodeport.yaml
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-web-service
spec:
  selector:
    app: my-web-app
  type: NodePort  # ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
  ports:
    - protocol: TCP
      port: 80          # ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  í¬íŠ¸
      targetPort: 80    # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í¬íŠ¸
      nodePort: 30080   # ë…¸ë“œì—ì„œ ì ‘ê·¼í•  í¬íŠ¸ (30000~32767 ì‚¬ì´)

```

```bash
kubectl apply -f service-nodeport.yaml
```

![](https://velog.velcdn.com/images/luckyprice1103/post/31b9325f-6967-4fc9-be35-eb7dcd092bab/image.png)


ì™¸ë¶€ ì ‘ì† ì„±ê³µ...!(ë³´ì•ˆ ê·¸ë£¹ì—ì„œë„ í¬íŠ¸ ì—´ì–´ì£¼ê¸°.)
![](https://velog.velcdn.com/images/luckyprice1103/post/fa638049-8d3a-4d46-8626-07d6e617afb3/image.png)



service-loadbalancer.yaml
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-web-service
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
spec:
  selector:
    app: my-web-app
  type: LoadBalancer  # í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œëŠ” LoadBalancer ìë™ ìƒì„±ë¨
  ports:
    - protocol: TCP
      port: 80          # ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  í¬íŠ¸
      targetPort: 80    # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í¬íŠ¸


```

```yaml
kubectl apply -f service-loadbalancer.yaml
kubectl get svc

```

![](https://velog.velcdn.com/images/luckyprice1103/post/aa91ba7d-7b1d-4657-bcc5-18d76ec620cb/image.png)

- external-ipê°€ pendingì—ì„œ ë©ˆì¶°ìˆìŒ.-> loadbalacnerë¥¼ ëª» ë§Œë“œëŠ” ìƒíƒœ


ğŸ’¡ AWS LoadBalancer Controllerë¥¼ ì‚¬ìš©í•˜ë ¤ë©´, EC2 ì¸ìŠ¤í„´ìŠ¤ì— IAM Roleì„ ë¶€ì—¬í•´ì•¼ í•¨.




âœ… 1ï¸âƒ£ í™˜ê²½ ì„¤ì • ë° ì¤€ë¹„
âœ” ë©€í‹° ë…¸ë“œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• (1 Master, 2 Worker)
âœ” EC2 IAM ì—­í•  ë¶€ì—¬ (LoadBalancer Controller ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •)

AWS ì½˜ì†”ì—ì„œ IAM ì—­í•  ìƒì„±

IAM â†’ Roles â†’ Create Role í´ë¦­
EC2 ì„ íƒ â†’ Next
ì •ì±… ì¶”ê°€ â†’ AdministratorAccess ì„ íƒ (í…ŒìŠ¤íŠ¸ìš©)
ì—­í•  ì´ë¦„: K8s-EC2-Role
Create Role ì™„ë£Œ
EC2 ì¸ìŠ¤í„´ìŠ¤ì— IAM Role í• ë‹¹

AWS ì½˜ì†” â†’ EC2 â†’ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ ì„ íƒ
"Actions" â†’ "Security" â†’ "Modify IAM Role" í´ë¦­
IAM Roleì„ K8s-EC2-Roleë¡œ ë³€ê²½
ì €ì¥ í›„ ì ìš©

âœ” AWS Load Balancer Controller ì„¤ì¹˜ (Helm ì‚¬ìš©)

âœ… 2ï¸âƒ£ ë¬¸ì œ ë°œìƒ & í•´ê²° ê³¼ì •
ğŸš¨ ë¬¸ì œ 1: LoadBalancer ìƒì„±ë˜ì§€ë§Œ External IP <pending> ìƒíƒœ
âŒ ì›ì¸: AWS Load Balancer Controllerê°€ ì˜¬ë°”ë¥¸ ì„œë¸Œë„·ì„ ì°¾ì§€ ëª»í•¨
ğŸ”§ í•´ê²°: Public Subnetì„ kubernetes.io/role/elb=1 íƒœê·¸ë¡œ ì„¤ì •


```bash
aws ec2 create-tags --resources <SUBNET_ID> --tags Key=kubernetes.io/role/elb,Value=1
```
ğŸš¨ ë¬¸ì œ 2: Target Groupì´ Worker ë…¸ë“œë¥¼ ë“±ë¡í•˜ì§€ ì•ŠìŒ
âŒ ì›ì¸: Worker ë…¸ë“œì— providerIDê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ
ğŸ”§ í•´ê²°: Worker ë…¸ë“œì— providerID ì¶”ê°€


```bash
kubectl patch node worker01 -p '{"spec":{"providerID":"aws://ap-northeast-2a/i-02655819459c13fc2"}}'
kubectl patch node worker02 -p '{"spec":{"providerID":"aws://ap-northeast-2b/i-0e99432702999f559"}}'
```
ğŸ”§ kubelet ì¬ì‹œì‘ í›„ í™•ì¸


```bash
sudo systemctl restart kubelet
kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{" â†’ "}{.spec.providerID}{"\n"}{end}'
```
ğŸš¨ ë¬¸ì œ 3: LoadBalancerëŠ” ìƒì„±ë˜ì—ˆì§€ë§Œ ì ‘ì†ì´ ì•ˆë¨
âŒ ì›ì¸:

Target Groupì´ Worker ë…¸ë“œë¥¼ unhealthy ìƒíƒœë¡œ ì¸ì‹

âœ… Target Group ìƒíƒœ í™•ì¸ & Worker ë…¸ë“œê°€ healthyì¸ì§€ ì²´í¬

```bash
  aws elbv2 describe-load-balancers --query "LoadBalancers[*].{Name:LoadBalancerName,DNS:DNSName,ARN:LoadBalancerArn}" --output json
aws elbv2 describe-target-groups --query "TargetGroups[*].{Name:TargetGroupName,ARN:TargetGroupArn}" --output json
```

  
```bash
aws elbv2 describe-target-health --target-group-arn <TARGET_GROUP_ARN>
aws elbv2 describe-target-health --target-group-arn arn:aws:elasticloadbalancing:ap-northeast-2:509399622222:targetgroup/k8s-default-mywebser-7ea040c771/e96dae729e11a684
  aws elbv2 describe-target-groups --query "TargetGroups[?TargetGroupName=='k8s-default-mywebser-7ea040c771']"
```
âœ… LoadBalancer Controller ì¬ì‹œì‘

```bash
kubectl delete pod -n kube-system -l app.kubernetes.io/name=aws-load-balancer-controller
```
âœ… 3ï¸âƒ£ ìµœì¢… í™•ì¸ & ì„±ê³µ ğŸ‰
âœ” kubectl get svc my-web-service ì‹¤í–‰ ì‹œ External IP ìƒì„±ë¨
âœ” LoadBalancer DNSë¡œ ì ‘ì† ê°€ëŠ¥
âœ” Target Groupì—ì„œ Worker ë…¸ë“œê°€ healthy ìƒíƒœ

![](https://velog.velcdn.com/images/luckyprice1103/post/906768b7-33cd-47f5-b0f5-2069c187f916/image.png)

  
  ### 4. Ingress ì„¤ì • ë° ì™¸ë¶€ ì ‘ê·¼ êµ¬ì„±
  
  âœ… ëª©í‘œ:

AWS **NLB(Network Load Balancer)**ë¥¼ ì‚¬ìš©í•˜ì—¬ Ingress Controllerì™€ ì—°ê²°
Ingressë¥¼ í†µí•´ ë“¤ì–´ì˜¨ íŠ¸ë˜í”½ì„ ë‚´ë¶€ ì„œë¹„ìŠ¤(Nginx)ë¡œ ì „ë‹¬
  
>   ì‚¬ìš©ì (HTTP ìš”ì²­)
      â†“
AWS LoadBalancer (NLB)
      â†“
Service (type=LoadBalancer, Ingress Controllerê°€ ì—°ê²°ë¨)
      â†“
Ingress (íŠ¸ë˜í”½ì„ ì–´ë””ë¡œ ë³´ë‚¼ì§€ ê²°ì •)
      â†“
Service (type=ClusterIP)
      â†“
Pod 1 (192.168.5.42:80)
Pod 2 (192.168.5.43:80)
Pod 3 (192.168.5.44:80)
Pod 4 (192.168.5.45:80)

  
  ğŸ“Œ (1) NGINX Ingress Controller ì„¤ì¹˜


```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
```
  
  ![](https://velog.velcdn.com/images/luckyprice1103/post/9ca4c2a6-b7e4-4388-9968-7b2b70f235f2/image.png)
  
 
ğŸ“Œ (2) ê¸°ì¡´ LoadBalancerë¥¼ Ingressì™€ ì—°ê²°
Ingressê°€ ê¸°ì¡´ LoadBalancerë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•˜ë ¤ë©´, Ingress Controllerì— NodePort ë°©ì‹ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ LoadBalancerê°€ Ingress íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸ”¹ Ingress Controllerë¥¼ NodePortë¡œ ë³€ê²½


```bash
kubectl patch svc ingress-nginx-controller -n ingress-nginx -p '{"spec": {"type": "NodePort"}}'
```
```bash
kubectl get svc -n ingress-nginx
```
ì¶œë ¥ ì˜ˆì‹œ:

![](https://velog.velcdn.com/images/luckyprice1103/post/b5127e6c-237a-43bc-a3da-96dc4f68ea25/image.png)

âœ” NodePort ë°©ì‹ìœ¼ë¡œ ë…¸ì¶œë¨
âœ” í¬íŠ¸ 32100ê³¼ 32200ì´ ìë™ í• ë‹¹ë¨

  
í• ë‹¹ë¨

ğŸ“Œ (3) ê¸°ì¡´ LoadBalancerê°€ Ingressë¡œ íŠ¸ë˜í”½ ì „ë‹¬í•˜ë„ë¡ ë³€ê²½
ê¸°ì¡´ LoadBalancerì—ì„œ Ingress Controllerì˜ NodePortë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•©ë‹ˆë‹¤.

ğŸ”¹ ê¸°ì¡´ LoadBalancer ì„œë¹„ìŠ¤ ë³€ê²½
  ![](https://velog.velcdn.com/images/luckyprice1103/post/255d3880-3e02-4da3-9ec3-63e54fb75e2b/image.png)
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-web-service
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
spec:
  selector:
    app: my-web-app
  type: LoadBalancer  # í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œëŠ” LoadBalancer ìë™ ìƒì„±ë¨
  ports:
    - name: http
      protocol: TCP
      port: 80
      targetPort: 32100  # Ingress Controllerì˜ HTTP NodePort
    - name: https
      protocol: TCP
      port: 443
      targetPort: 32200  # Ingress Controllerì˜ HTTPS NodePort
  selector:
    app.kubernetes.io/name: ingress-nginx
```

âœ” ì´ ì„¤ì •ì„ ì ìš©í•˜ë©´:

ê¸°ì¡´ LoadBalancer (my-web-loadbalancer) ê°€ Ingress Controllerì˜ NodePortë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬
Ingressê°€ ë„ë©”ì¸ ê¸°ë°˜ íŠ¸ë˜í”½ì„ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…
Ingressê°€ LoadBalancerì˜ EXTERNAL-IPë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©

```bash
kubectl apply -f my-web-loadbalancer.yaml
kubectl get svc
```
EXTERNAL-IPê°€ ê¸°ì¡´ LoadBalancerì™€ ë™ì¼í•´ì•¼ í•¨.
  
  
ğŸ“Œ (4) Ingress ë¦¬ì†ŒìŠ¤ ìƒì„±
ì´ì œ Ingressë¥¼ ì„¤ì •í•˜ì—¬ ë„ë©”ì¸ ê¸°ë°˜ íŠ¸ë˜í”½ì„ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ….

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-web-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
    - host: myweb.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: my-web-service
                port:
                  number: 80
```
âœ” í•µì‹¬ ë‚´ìš©

ingressClassName: nginx â†’ NGINX Ingress Controller ì‚¬ìš©
host: myweb.local â†’ ë„ë©”ì¸ ê¸°ë°˜ íŠ¸ë˜í”½ ë¼ìš°íŒ…
backend.service.name: my-web-service â†’ íŠ¸ë˜í”½ì„ my-web-serviceë¡œ ì „ë‹¬

```bash
kubectl apply -f ingress.yaml
kubectl get ingress
```

  ![](https://velog.velcdn.com/images/luckyprice1103/post/ad6987bf-95a3-4e47-9211-66c51c6d256e/image.png)

![](https://velog.velcdn.com/images/luckyprice1103/post/4e5c2ca7-c1dd-48d8-af4b-f9b1adb3dd3d/image.png)


- ì—ëŸ¬. ingress-nginx-controllerê°€ dnsì£¼ì†Œë¥¼ ì œëŒ€ë¡œ ë°›ì•„ì˜¤ì§€ ëª»í•¨.  
  
âœ… ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ëœ ê²½ìš°, ì•„ë˜ ìˆœì„œë¡œ ë™ì‘í•´ì•¼ í•¨

my-web-serviceê°€ AWS NLBì—ì„œ ë°›ì€ íŠ¸ë˜í”½ì„ Ingress Controller(NodePort)ë¡œ ì „ë‹¬
Ingress Controllerê°€ íŠ¸ë˜í”½ì„ ë°›ì•„ì„œ ì ì ˆí•œ ë‚´ë¶€ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…
Ingress ë¦¬ì†ŒìŠ¤(ingress.yaml)ê°€ my-web-serviceë¡œ ìš”ì²­ì„ ì „ë‹¬
> ì‚¬ìš©ì (ë¸Œë¼ìš°ì €)
  â†“
AWS NLB (80, 443)
  â†“
Kubernetes NodePort (31814, 30256)
  â†“
Ingress-NGINX Controller (80, 443) âœ… ì˜¬ë°”ë¥¸ í¬íŠ¸ë¡œ ì—°ê²°ë¨!
  â†“
Ingress ê·œì¹™ì— ë”°ë¼ ë‚´ë¶€ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬
  â†“
Kubernetes Service (my-web-service)
  â†“
Pod (my-web-app)

  - í•´ê²° ë°©ë²•
  
  1ï¸âƒ£ Ingress-NGINX Controller ë°°í¬

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
```
  
Ingress Controllerë¥¼ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬.

  
2ï¸âƒ£ Ingress-NGINX ì„œë¹„ìŠ¤ ì„¤ì • (NLB ì—°ë™)

```yaml
apiVersion: v1
kind: Service
metadata:
  name: ingress-nginx-controller
  namespace: ingress-nginx
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
spec:
  type: LoadBalancer
  externalTrafficPolicy: Local
  selector:
    app.kubernetes.io/name: ingress-nginx
  ports:
    - name: http
      nodePort: 31814
      port: 80
      protocol: TCP
      targetPort: 80  # Ingress Controller ë‚´ë¶€ í¬íŠ¸ì™€ ì¼ì¹˜
    - name: https
      nodePort: 30256
      port: 443
      protocol: TCP
      targetPort: 443  # Ingress Controller ë‚´ë¶€ í¬íŠ¸ì™€ ì¼ì¹˜
```
> âš ï¸ ì¤‘ìš”:
targetPort: 80, 443 â†’ Ingress Controllerê°€ ì‹¤ì œë¡œ ìˆ˜ì‹ í•˜ëŠ” í¬íŠ¸
nodePort: 31814, 30256 â†’ NodePortë¥¼ í†µí•´ NLBê°€ ì—°ê²°ë˜ëŠ” í¬íŠ¸
externalTrafficPolicy: Local â†’ í´ë¼ì´ì–¸íŠ¸ì˜ ì‹¤ì œ IPë¥¼ ìœ ì§€í•˜ë„ë¡ ì„¤ì •

  
3ï¸âƒ£ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ (my-web-service)

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-web-service
  namespace: default
spec:
  selector:
    app: my-web-app
  type: ClusterIP
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80  # ì• í”Œë¦¬ì¼€ì´ì…˜ Pod ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
```

4ï¸âƒ£ Ingress ì„¤ì •
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx-ingress
  namespace: default
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: my-web-service  # ë‚´ë¶€ ì„œë¹„ìŠ¤
                port:
                  number: 80
```

host: myweb.local ë˜ëŠ” NLBì˜ DNS ì£¼ì†Œ ì‚¬ìš© ê°€ëŠ¥
nginx.ingress.kubernetes.io/rewrite-target: / â†’ ìš”ì²­ URLì„ ì¬ì‘ì„±í•˜ì—¬ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì— ì „ë‹¬
service.name: my-web-service â†’ íŠ¸ë˜í”½ì´ ì „ë‹¬ë  ì„œë¹„ìŠ¤
ì ìš© ëª…ë ¹ì–´

  
  ì ‘ì† ì„±ê³µ..
![](https://velog.velcdn.com/images/luckyprice1103/post/c25b5113-a40b-4714-a843-3d8a69d3771b/image.png)
  
  
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—¬ëŸ¬ ê°œì˜ íŒŒë“œë¡œ ë°°í¬í•˜ê³ , ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„œë¹„ìŠ¤(Service)ë¥¼ ì„¤ì •í•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆìŒ.

![](https://velog.velcdn.com/images/luckyprice1103/post/5b1a6e0b-8483-401b-8909-78405bcde3f3/image.png)

 
### 5. ê²°ê³¼
  âœ… 1ë‹¨ê³„
âœ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë©€í‹°ë…¸ë“œ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ì™„ë£Œ
âœ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ (Nginx ê¸°ë°˜) ë°°í¬ ì™„ë£Œ
âœ” ì„œë¹„ìŠ¤(Service) ë° Ingress ì„¤ì • ì™„ë£Œ
âœ” AWS LoadBalancer(NLB) ì—°ê²° ì™„ë£Œ
âœ” ì™¸ë¶€ì—ì„œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ìƒ ì ‘ì† í™•ì¸