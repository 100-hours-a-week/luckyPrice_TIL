# 1. ë„¤íŠ¸ì›Œí¬ êµ¬ì¶•


## 1. ê¸°ë³¸ êµ¬ì¡° êµ¬ì„±

![](https://velog.velcdn.com/images/luckyprice1103/post/6d4764e2-b0d0-47d0-8472-270fb38b6d44/image.png)

ì„œë¸Œë„·ê³¼ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì„¤ì •í• ë•Œ ë¯¸ë¦¬ ê° ì„œë¸Œë„·ì— í• ë‹¹í•  ipv4 CIDR ë¸”ë¡ì„ ê²€í† í•´ì£¼ëŠ”ê²ƒì´ ì¢‹ë‹¤.

ë„ˆë¬´ í¬ê²Œ ì¡ìœ¼ë©´ ë‚˜ì¤‘ì— ìƒˆ ì„œë¸Œë„· í• ë‹¹ì— í•„ìš”í•œ ipì£¼ì†Œê°€ ê³ ê°ˆë˜ê¸°ë„ í•˜ê³ , ë„ˆë¬´ ì‘ê²Œ ì¡ìœ¼ë©´ í™•ì¥ì‹œ ipí• ë‹¹ì„ ëª»í•˜ëŠ”ë“± ê´€ë¦¬ì— ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ Fargate ê°™ì€ ê²½ìš° ì»¨í…Œì´ë„ˆë³„ë¡œ ENI ì£¼ì†Œê°€ ë¶€ì—¬ë˜ë¯€ë¡œ, ì˜ˆì¸¡í•˜ê¸° í˜ë“¤ê¸´í•˜ë‹¤...!

ì´ë²ˆì—ëŠ” ê° ì„œë¸Œë„·ì–´ ê°™ì€ ìˆ˜ì˜ ipë¥¼ í• ë‹¹ í•  ìˆ˜ ìˆë„ë¡ /24 ë¡œ ê°ê°ì˜ ì„œë¸Œë„·ì˜ ì£¼ì†Œë¥¼ í†µì¼.
ì„œë¸Œë„· í•˜ë‚˜ë‹¹ 256-nê°œì˜ í˜¸ìŠ¤íŠ¸ ipë¥¼ ê°€ì§€ê²Œ í•˜ì.

- ë³´ì•ˆê·¸ë£¹
![](https://velog.velcdn.com/images/luckyprice1103/post/53053812-7d17-4d51-9bc4-58f7a86428d8/image.svg)
ì•„ì›ƒ ë°”ìš´ë“œ ê·œì¹™ì€ 0.0.0.0/0ì„ í—ˆê°€í•˜ê³  ì¸ë°”ìš´ë“œ ingressëŠ” ìµœì†Œí•œì˜ ê·œì¹™ì„ í—ˆê°€.

## 2. CloudFormationì„ ì‚¬ìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ êµ¬ì¶•.


ì‚¬ìš©í•  ê¸°ë³¸ clouformation í…œí”Œë › íŒŒì¼
```yaml
AWSTemplateFormatVersion: "2010-09-09"
Description: Network resource template part1
Resources:
  # VPC ì„¤ì •
  sbcntrVpc:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: sbcntrVpc

  ############### Subnet, RouteTable, IGW ###############
  # ì»¨í…Œì´ë„ˆ ê´€ë ¨ ì„¤ì • 
  ## ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© í”„ë¼ì´ë¹— ì„œë¸Œë„·
  sbcntrSubnetPrivateContainer1A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.8.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: sbcntr-subnet-private-container-1a
        - Key: Type
          Value: Isolated
  sbcntrSubnetPrivateContainer1C:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.9.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: sbcntr-subnet-private-container-1c
        - Key: Type
          Value: Isolated
  ## ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© ë¼ìš°íŒ… í…Œì´ë¸”
  sbcntrRouteApp:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: sbcntrVpc
      Tags:
        - Key: Name
          Value: sbcntr-route-app
  ## ì»¨í…Œì´ë„ˆ ì„œë¸Œë„·ê³¼ ë¼ìš°íŒ… ì—°ê²°
  sbcntrRouteAppAssociation1A:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteApp
      SubnetId:
        Ref: sbcntrSubnetPrivateContainer1A
  sbcntrRouteAppAssociation1C:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteApp
      SubnetId:
        Ref: sbcntrSubnetPrivateContainer1C

  # DBê´€ë ¨ ì„¤ì •
  ## DBìš© í”„ë¼ì´ë¹— ì„œë¸Œë„·
  sbcntrSubnetPrivateDb1A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.16.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: sbcntr-subnet-private-db-1a
        - Key: Type
          Value: Isolated
  sbcntrSubnetPrivateDb1C:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.17.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: sbcntr-subnet-private-db-1c
        - Key: Type
          Value: Isolated
  ## DBìš© ë¼ìš°íŒ… í…Œì´ë¸”
  sbcntrRouteDb:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: sbcntrVpc
      Tags:
        - Key: Name
          Value: sbcntr-route-db
  ## DB ì„œë¸Œë„·ì— ë¼ìš°íŒ… ì—°ê²°
  sbcntrRouteDbAssociation1A:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteDb
      SubnetId:
        Ref: sbcntrSubnetPrivateDb1A
  sbcntrRouteDbAssociation1C:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteDb
      SubnetId:
        Ref: sbcntrSubnetPrivateDb1C

  # Ingress ê´€ë ¨ ì„¤ì •
  ## Ingressìš© í¼ë¸”ë¦­ ì„œë¸Œë„·
  sbcntrSubnetPublicIngress1A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.0.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: sbcntr-subnet-public-ingress-1a
        - Key: Type
          Value: Public
  sbcntrSubnetPublicIngress1C:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.1.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: sbcntr-subnet-public-ingress-1c
        - Key: Type
          Value: Public
  ## Ingressìš© ë¼ìš°íŒ… í…Œì´ë¸”
  sbcntrRouteIngress:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: sbcntrVpc
      Tags:
        - Key: Name
          Value: sbcntr-route-ingress
  ## Ingressìš© ì„œë¸Œë„·ì— ë¼ìš°íŒ… ì—°ê²°
  sbcntrRouteIngressAssociation1A:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteIngress
      SubnetId:
        Ref: sbcntrSubnetPublicIngress1A
  sbcntrRouteIngressAssociation1C:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteIngress
      SubnetId:
        Ref: sbcntrSubnetPublicIngress1C
  ## Ingressìš© ë¼ìš°íŒ… í…Œì´ë¸”ì˜ ê¸°ë³¸ ë¼ìš°íŒ…
  sbcntrRouteIngressDefault:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: sbcntrRouteIngress
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: sbcntrIgw
    DependsOn:
      - sbcntrVpcgwAttachment

  # ê´€ë¦¬ ì„œë²„ ê´€ë ¨ ì„¤ì •
  ## ê´€ë¦¬ìš© í¼ë¸”ë¦­ ì„œë¸Œë„·
  sbcntrSubnetPublicManagement1A:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.240.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: sbcntr-subnet-public-management-1a
        - Key: Type
          Value: Public
  sbcntrSubnetPublicManagement1C:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.0.241.0/24
      VpcId:
        Ref: sbcntrVpc
      AvailabilityZone: 
        Fn::Select: 
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: sbcntr-subnet-public-management-1c
        - Key: Type
          Value: Public
  ## ê´€ë¦¬ìš© ì„œë¸Œë„·ì˜ ë¼ìš°íŒ…ì€ Ingressì™€ ë™ì¼í•˜ê²Œ ìƒì„±
  sbcntrRouteManagementAssociation1A:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteIngress
      SubnetId:
        Ref: sbcntrSubnetPublicManagement1A
  sbcntrRouteManagementAssociation1C:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: sbcntrRouteIngress
      SubnetId:
        Ref: sbcntrSubnetPublicManagement1C

  # ì¸í„°ë„· ì ‘ì†ì„ ìœ„í•œ ê²Œì´íŠ¸ì›¨ì´ ìƒì„±
  sbcntrIgw:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: sbcntr-igw
  sbcntrVpcgwAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId:
        Ref: sbcntrVpc
      InternetGatewayId:
        Ref: sbcntrIgw

  ############### Security groups ###############
  # ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  ## ì¸í„°ë„· ê³µê°œìš© ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  sbcntrSgIngress:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for ingress
      GroupName: ingress
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      SecurityGroupIngress:
        - CidrIp: 0.0.0.0/0
          Description: from 0.0.0.0/0:80
          FromPort: 80
          IpProtocol: tcp
          ToPort: 80
        - CidrIpv6: ::/0
          Description: from ::/0:80
          FromPort: 80
          IpProtocol: tcp
          ToPort: 80
      Tags:
        - Key: Name
          Value: sbcntr-sg-ingress
      VpcId:
        Ref: sbcntrVpc
  ## ê´€ë¦¬ ì„œë²„ìš© ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  sbcntrSgManagement:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security Group of management server
      GroupName: management
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      Tags:
        - Key: Name
          Value: sbcntr-sg-management
      VpcId:
        Ref: sbcntrVpc
  ## ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  sbcntrSgContainer:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security Group of backend app
      GroupName: container
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      Tags:
        - Key: Name
          Value: sbcntr-sg-container
      VpcId:
        Ref: sbcntrVpc
  ## í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ìš© ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  sbcntrSgFrontContainer:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security Group of front container app
      GroupName: front-container
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      Tags:
        - Key: Name
          Value: sbcntr-sg-front-container
      VpcId:
        Ref: sbcntrVpc
  ## ë‚´ë¶€ìš© ë¡œë“œë°¸ëŸ°ì„œì˜ ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  sbcntrSgInternal:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for internal load balancer
      GroupName: internal
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      Tags:
        - Key: Name
          Value: sbcntr-sg-internal
      VpcId:
        Ref: sbcntrVpc
  ## DBìš© ë³´ì•ˆ ê·¸ë£¹ ìƒì„±
  sbcntrSgDb:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security Group of database
      GroupName: database
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      Tags:
        - Key: Name
          Value: sbcntr-sg-db
      VpcId:
        Ref: sbcntrVpc

  # ì—­í•  ì—°ê²°
  ## Internet LB -> Front Container
  sbcntrSgFrontContainerFromsSgIngress:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: HTTP for Ingress
      FromPort: 80
      GroupId:
        Fn::GetAtt:
          - sbcntrSgFrontContainer
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgIngress
          - GroupId
      ToPort: 80  
  ## Front Container -> Internal LB
  sbcntrSgInternalFromSgFrontContainer:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: HTTP for front container
      FromPort: 80
      GroupId:
        Fn::GetAtt:
          - sbcntrSgInternal
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgFrontContainer
          - GroupId
      ToPort: 80
  ## Internal LB -> Back Container
  sbcntrSgContainerFromSgInternal:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: HTTP for internal lb
      FromPort: 80
      GroupId:
        Fn::GetAtt:
          - sbcntrSgContainer
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgInternal
          - GroupId
      ToPort: 80      
  ## Back container -> DB
  sbcntrSgDbFromSgContainerTCP:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: MySQL protocol from backend App
      FromPort: 3306
      GroupId:
        Fn::GetAtt:
          - sbcntrSgDb
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgContainer
          - GroupId
      ToPort: 3306
  ## Front container -> DB
  sbcntrSgDbFromSgFrontContainerTCP:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: MySQL protocol from frontend App
      FromPort: 3306
      GroupId:
        Fn::GetAtt:
          - sbcntrSgDb
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgFrontContainer
          - GroupId
      ToPort: 3306
  ## Management server -> DB
  sbcntrSgDbFromSgManagementTCP:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: MySQL protocol from management server
      FromPort: 3306
      GroupId:
        Fn::GetAtt:
          - sbcntrSgDb
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgManagement
          - GroupId
      ToPort: 3306  
  ## Management server -> Internal LB
  sbcntrSgInternalFromSgManagementTCP:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      IpProtocol: tcp
      Description: HTTP for management server
      FromPort: 80
      GroupId:
        Fn::GetAtt:
          - sbcntrSgInternal
          - GroupId
      SourceSecurityGroupId:
        Fn::GetAtt:
          - sbcntrSgManagement
          - GroupId
      ToPort: 80

```
ìŠ¤íƒ ìƒì„± ì™„ë£Œ....!
![](https://velog.velcdn.com/images/luckyprice1103/post/af5906ed-6f75-4c5b-90de-d13397242ef1/image.png)



## 3. ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶•

í”„ëŸ°íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ blitx.jsë¥¼ ì‚¬ìš©í•œ react ì›¹ í”„ë¡œê·¸ë¨.
ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ gloangìœ¼ë¡œ êµ¬ì¶•í•œ api ì„œë²„.
![](https://velog.velcdn.com/images/luckyprice1103/post/95beb93e-de67-42c7-b0ed-559b37931d74/image.jpg)

- í”„ëŸ°íŠ¸ì—”ë“œëŠ” next.js SSRì„ ì´ìš©í•˜ì—¬ ë§Œë“ ë‹¤.
- apiì„œë²„ëŠ” echo í”„ë ˆì„ì›Œí¬ë¥¼ í™œìš©í•´ rest api ì„œë²„ë¥¼ êµ¬ì¶•.
- ë°±ì•¤ë“œëŠ” ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ë¡œ, itemrhk notificationì„ ë‚˜ëˆ ì„œ êµ¬ì¶•í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œëŠ” ì„œë¹„ìŠ¤ ë‹¨ìœ„ë¡œ ecsë¥¼ ë¶„ë¦¬í•´ì•¼í•˜ì§€ë§Œ, ì´ë²ˆì—ëŠ” í•œê°œì˜ ecsì•ˆì— í•¨ê»˜ë‘”ë‹¤.


ì¤‘ìš”í•œê±´ í”„ëŸ°íŠ¸ì—”ë“œì—ì„œ apií˜¸ì¶œê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†ì´ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ëŠ” 
ê²ƒ....!


# ë‚˜ì¤‘ì— github ì£¼ì†Œ ì¶”ê°€.






## 4. ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ êµ¬ì¶•.

ì»¨í…Œì´ë„ˆë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë°‘ì˜ ë‹¨ê³„ë¥¼ ì§„í–‰í•´ì•¼í•œë‹¤.
1. ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìƒì„±.
2. ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ìš© ë„¤íŠ¸ì›Œí¬ ìƒì„±.
3. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
4. ì»¨í…Œì´ë„ˆ ë¹Œë“œ
5. ì»¨í…Œì´ëŸ¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì´ë¯¸ì§€ ì·¨ë“ í›„ ë°°í¬


![](https://velog.velcdn.com/images/luckyprice1103/post/d87ea7cb-2363-4a26-9107-2e82bea50015/image.svg)

Cloudì—ì„œ ì¤€ë¹„í•œ ì˜ˆì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•. ì—¬ê¸°ì„œ Cloud9ì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ëŠ” ê´€ë¦¬ ì„œë²„ë¡œ ê°„ì£¼. ì¶”ê°€ë¡œ ë„¤íŠ¸ì›Œí¬ë„ ì•½ê°„ ë³€ê²½.

ECRê³¼ ì—°ê²°í•  ì¸í„°í˜ì´ìŠ¤í˜• vpc ì—”ë“œí¬ì¸íŠ¸ê°€ ì†í•œ ì„œë¸Œë„·ì€ ë‹¤ë¥¸ ì„œë¸Œë„·(ë°±ì•¤ë“œ, db)ê³¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ ì„œë¸Œë„·ì„ ìƒì„±.
![](https://velog.velcdn.com/images/luckyprice1103/post/3f8e04c8-f105-4925-a615-7d92481e8584/image.png)
ìƒì„±í•œ ECSê°€ ì¸í„°ë„·ì„ ê²½ìœ í•˜ì§€ ì•Šê³  ECRì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ECRìš© VPCì—”ë“œí¬ì´ì¸íŠ¸, S3ìš© ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±.

ì¼ë‹¨ì€ ë°±ì•¤ë“œë¡œë§Œ ë™ì¥ í™•ì¸ì„ í•´ë³¼ê±´ë°, ê´€ë¦¬ ì„œë²„ì—ì„œ ECRì—ì„œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì·¨ë“í•´ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í•˜ê³  ë™ì‘ í™•ì¸ì„ ìˆ˜í–‰.



Amazon Elastic Container Registryì—ì„œ ecrì„ ìƒì„±í•˜ì.
![](https://velog.velcdn.com/images/luckyprice1103/post/6e974255-bd04-4b09-a8d0-39b063e4ecd3/image.png)

ì´ì œ ECRì— ì ‘ì†í•˜ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ê²½ë¡œê°€ ë˜ëŠ” VPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€.

ë§ˆì°¬ê°€ì§€ë¡œ cloudformationì„ ì‚¬ìš©í•˜ì—¬ ì„œë¸Œë„·ê³¼ ë³´ì•ˆê·¸ë£¹ì„ ìƒì„±.
![](https://velog.velcdn.com/images/luckyprice1103/post/0b7fabc8-8b82-44f7-92d4-6780b762b994/image.png)

ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ê³  ì´ì œ egress ì„œë¸Œë„·ì´ ìƒê²¼ìœ¼ë‹ˆ, ì—¬ê¸°ì— vpcì—”ë“œ í¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì. ECRì€ VPC ë‚´ë¶€ê°€ ì•„ë‹Œ ë¦¬ì „ë§ˆë‹¤ ì¡´ì¬í•˜ëŠ” ë¦¬ì „ ì„œë¹„ìŠ¤ì´ë¯€ë¡œ, VPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ì–´ì•¼í•œë‹¤.



## 5. vpc ì—”ë“œí¬ì¸íŠ¸ ìƒì„±.

VPCì—”ë“œí¬ì¸íŠ¸ëŠ” ëª‡ê°€ì§€ ì¢…ë¥˜ê°€ ìˆë‹¤. ECRì— ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ì·¨ë“í•˜ê¸° ìœ„í•´ì„œëŠ” 3ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ê°€ í•„ìš”í•˜ë‹¤.

- ì¸í„°í˜ì´ìŠ¤í˜• - ECR APIë¥¼ ì´ìš©í•˜ê¸° ìœ„í•œ ì—”ë“œí¬ì¸íŠ¸
- ì¸í„°í˜ì´ìŠ¤ì…©í˜• - Docker í´ë¼ì´ì–¸íŠ¸ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì—”ë“œí¬ì¸íŠ¸
- ê²Œì´íŠ¸ì›¨ì´í˜• - Docker ì´ë¯¸ì§€ ì·¨ë“ì„ ìœ„í•œ ì—”ë“œí¬ì¸ë“œ


### 1. ì¸í„°í˜ì´ìŠ¤í˜• vpc ì—”ë“œí¬ì¸íŠ¸ ìƒì„±.
![](https://velog.velcdn.com/images/luckyprice1103/post/f8ab433d-e3dc-41cb-808e-5e48642a3e80/image.png)

### 2. ê²Œì´íŠ¸ì›¨ì´í˜• vpc ì—”ë“œí¬ì¸íŠ¸ ìƒì„±.
![](https://velog.velcdn.com/images/luckyprice1103/post/5f54327f-34e2-4fbb-8b71-9dbaae39034f/image.png)

## 5. ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡.


ë¨¼ì € management ì„œë¸Œë„·ì— ìˆëŠ” ec2ì—ì„œ endpointë¥¼ ì‚¬ìš©í•´ì„œ ecrì— ì ‘ê·¼ í• ìˆ˜ ìˆë„ë¡ ì—­í• ì„ ë¶€ì—¬í•œë‹¤.
![](https://velog.velcdn.com/images/luckyprice1103/post/e069a427-76fd-414f-8117-938d872c9fc8/image.png)

ë‹¤ìŒì€ managementì•ˆì— ìˆëŠ” ec2ì—ì„œ ë°±ì•¤ë“œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤.
![](https://velog.velcdn.com/images/luckyprice1103/post/4dfb290b-9a47-46eb-b1dc-6d958c902a6b/image.png)


**Docker ì´ë¯¸ì§€ë¥¼ AWS Elastic Container Registry (ECR)** ì— í‘¸ì‹œí•˜ê¸° ìœ„í•´ì„œëŠ” **íƒœê·¸(Tag)** ë¥¼ ì„¤ì •í•´ì•¼í•œë‹¤.



### ğŸ”¹ ì™œ ì´ë ‡ê²Œ í•˜ëŠ”ê°€?
1. **ECRì—ì„œ ê´€ë¦¬í•˜ëŠ” ì´ë¯¸ì§€ URLì„ ë§ì¶”ê¸° ìœ„í•´**  
   - AWS ECRì— ì´ë¯¸ì§€ë¥¼ í‘¸ì‹œí•˜ë ¤ë©´ **ECR ë¦¬í¬ì§€í† ë¦¬ ì£¼ì†Œ + íƒœê·¸** í˜•ì‹ì˜ íƒœê·¸ê°€ í•„ìš”í•¨  
   - `AWS_ACCOUNT_ID.dkr.ecr.ap-northeast-2.amazonaws.com/sbcntr-backend:v1` í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ ECRê³¼ í˜¸í™˜ë˜ë„ë¡ ë§Œë“¦

2. **ECRì— Pushí•˜ê¸° ìœ„í•œ ì‚¬ì „ ë‹¨ê³„**
   - `docker push` ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ECR ë¦¬í¬ì§€í† ë¦¬ ì£¼ì†Œë¥¼ íƒœê·¸ë¡œ ì„¤ì •í•´ì•¼ í•¨
   - `docker tag` ì´í›„ `docker push ${aws_account_id}.dkr.ecr.ap-northeast-2.amazonaws.com/sbcntr-backend:v1` ì‹¤í–‰ ê°€ëŠ¥

### ğŸ”¹ ìµœì¢… ì‹¤í–‰ ì˜ˆì‹œ
```bash
aws_account_id=$(aws sts get-caller-identity --query 'Account' --output text)
docker image tag sbcntr-backend:v1 ${aws_account_id}.dkr.ecr.ap-northeast-2.amazonaws.com/sbcntr-backend:v1
docker push ${aws_account_id}.dkr.ecr.ap-northeast-2.amazonaws.com/sbcntr-backend:v1
```
âœ… **ê²°ë¡ **: AWS ECRì— í‘¸ì‹œí•  ìˆ˜ ìˆë„ë¡ **ì´ë¯¸ì§€ íƒœê·¸ë¥¼ ECR ì£¼ì†Œ í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê³¼ì •**


ë‹¤ìŒì€ ë¡œê·¸ì¸ì„ í•´ì•¼í•œë‹¤.
```bash
aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin {aws account ì•„ì´ë””}.dkr.ecr.ap-northeast-2.amazonaws.com/sbcntr-backend
```
![](https://velog.velcdn.com/images/luckyprice1103/post/faa6d12d-7465-4317-8823-63f60936e9c5/image.png)

docker image push ëª…ë ¹ì„ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ ë“±ë¡.

![](https://velog.velcdn.com/images/luckyprice1103/post/f4bf06c0-48f9-417a-90d3-da54cdfe1465/image.png)

push ì„±ê³µ.
![](https://velog.velcdn.com/images/luckyprice1103/post/12bd707a-652b-4a2b-9a5b-60c8bb33a804/image.png)
í†µì‹  ì„±ê³µ.



frontendë„ ë˜‘ê°™ì´ push í•´ë³´ê³  pull í•´ë³´ì.